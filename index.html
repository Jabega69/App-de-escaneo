<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>DocuMind Scan</title>

  <!-- Polyfill process -->
  <script>
    window.process = { env: { API_KEY: '' } };

    window.onerror = function (msg, url, line, col, error) {
      const root = document.getElementById('root');
      if (root) {
        // Don't overwrite if it's just a warning, but if it's fatal:
        if (msg.toLowerCase().includes('script error') || msg.toLowerCase().includes('failed to load')) {
          root.innerHTML = `
              <div style="padding: 20px; font-family: sans-serif; color: #ef4444; background: #fee2e2; height: 100vh;">
                <h2 style="font-weight: bold; margin-bottom: 10px;">Application Error</h2>
                <p style="margin-bottom: 10px;">${msg}</p>
                <pre style="font-size: 11px; overflow: auto; background: white; padding: 10px; border-radius: 8px;">${error ? error.stack : 'Check console for details.'}</pre>
              </div>
            `;
        }
      }
      return false;
    };
  </script>

  <!-- Suppress Tailwind CDN warning -->
  <script>
    const originalWarn = console.warn;
    console.warn = (...args) => {
      if (args[0] && typeof args[0] === 'string' && args[0].includes('cdn.tailwindcss.com')) return;
      originalWarn.apply(console, args);
    };
  </script>

  <!-- Dependencies -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f2f2f7;
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      user-select: none;
      padding-top: env(safe-area-inset-top);
      padding-bottom: env(safe-area-inset-bottom);
      padding-left: env(safe-area-inset-left);
      padding-right: env(safe-area-inset-right);
    }

    .select-text {
      user-select: text;
      -webkit-user-select: text;
    }

    /* Loading Spinner for initial load */
    .initial-loader {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      color: #64748b;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #e2e8f0;
      border-top: 4px solid #3b82f6;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 16px;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translate3d(0, 20px, 0);
      }

      to {
        opacity: 1;
        transform: none;
      }
    }

    .animate-fade-in-up {
      animation: fadeInUp 0.5s ease-out;
    }

    .animate-pulse-slow {
      animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    .animate-spin-slow {
      animation: spin 3s linear infinite;
    }
  </style>

  <script type="importmap">
    {
      "imports": {
        "lucide-react": "https://aistudiocdn.com/lucide-react@^0.555.0",
        "react/": "https://aistudiocdn.com/react@^19.2.0/",
        "react": "https://aistudiocdn.com/react@^19.2.0",
        "react-dom": "https://aistudiocdn.com/react-dom@^19.2.0",
        "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
        "@google/genai": "https://aistudiocdn.com/@google/genai@^1.30.0"
      }
    }
    </script>
</head>

<body>
  <div id="root">
    <div class="initial-loader">
      <div class="spinner"></div>
      <p>Loading DocuMind...</p>
    </div>
  </div>

  <!-- MAIN APPLICATION SCRIPT -->
  <script type="text/babel" data-presets="typescript,react" data-type="module">
    import React, { useState, useEffect, useRef } from 'react';
    import ReactDOM from 'react-dom/client';
    import { GoogleGenAI } from "@google/genai";
    import { Camera, FileText, Upload, Loader2, Sparkles, BrainCircuit, Copy, Share, ArrowLeft, Download, Cloud, ChevronRight, Plus, Clock, Settings } from 'lucide-react';

    // --- TYPES ---

    // Interface definitions (compile away in JS but good for reference)
    // ViewState: HOME, SCANNING, PROCESSING, RESULT, ANALYSIS
    // ProcessingState: status (idle, uploading, ocr, thinking, complete, error), message

    // --- SERVICE ---

    let aiInstance = null;

    const getAI = () => {
      if (!aiInstance) {
        const apiKey = localStorage.getItem('documind_api_key') ||
          ((typeof process !== 'undefined' && process.env && process.env.API_KEY) ? process.env.API_KEY : '');

        if (!apiKey) {
          throw new Error("API Key missing");
        }
        aiInstance = new GoogleGenAI({ apiKey });
      }
      return aiInstance;
    };

    const extractTextFromDocument = async (base64Data, mimeType) => {
      try {
        const ai = getAI();
        const modelId = 'gemini-1.5-flash';
        const response = await ai.models.generateContent({
          model: modelId,
          contents: {
            parts: [
              { inlineData: { mimeType: mimeType, data: base64Data } },
              { text: "Transcribe the text from this document exactly as it appears. Maintain the structure (lists, headers) using Markdown. Do not include any intro or outro text." }
            ]
          }
        });
        return response.text || "No text could be extracted.";
      } catch (error) {
        console.error("Gemini OCR Error:", error);
        const errorDetails = error instanceof Error ? error.message : JSON.stringify(error);
        throw new Error(errorDetails || "Failed to extract text (Unknown Error)");
      }
    };

    const analyzeDocumentContent = async (text, base64Data, mimeType) => {
      try {
        const ai = getAI();
        const modelId = 'gemini-1.5-pro';

        const parts = [{ text: `Analyze this document content:\n\n${text}\n\nProvide a structured summary including:\n1. Document Type\n2. Key Dates\n3. Main Entities (People/Companies)\n4. Action Items or Summary` }];

        if (base64Data && mimeType) {
          parts.unshift({
            inlineData: { mimeType: mimeType, data: base64Data }
          });
        }

        const response = await ai.models.generateContent({
          model: modelId,
          contents: { parts },
          // config: {
          //   thinkingConfig: { thinkingBudget: 32768 }
          // }
        });

        return response.text || "Analysis failed.";
      } catch (error) {
        console.error("Gemini Analysis Error:", error);
        throw new Error("Failed to analyze the document.");
      }
    };

    // --- HELPERS ---

    const fileToBase64 = (file) => {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => {
          let encoded = reader.result?.toString().replace(/^data:(.*,)?/, '');
          if ((encoded?.length || 0) % 4 > 0) {
            encoded += '='.repeat(4 - (encoded?.length || 0) % 4);
          }
          resolve(encoded || '');
        };
        reader.onerror = error => reject(error);
      });
    };

    // --- COMPONENTS ---

    const Scanner = ({ onFileSelected }) => {
      const fileInputRef = useRef(null);

      const handleFileChange = (e) => {
        if (e.target.files && e.target.files.length > 0) {
          onFileSelected(e.target.files[0]);
        }
      };

      const triggerCamera = () => {
        fileInputRef.current?.setAttribute("capture", "environment");
        fileInputRef.current?.click();
      };

      const triggerUpload = () => {
        fileInputRef.current?.removeAttribute("capture");
        fileInputRef.current?.click();
      };

      return (
        <div className="flex flex-col items-center justify-center h-full p-6 space-y-8 animate-fade-in-up">
          <div className="text-center space-y-2">
            <div className="w-20 h-20 bg-blue-100 text-blue-600 rounded-3xl flex items-center justify-center mx-auto mb-6 shadow-sm">
              <FileText size={40} />
            </div>
            <h2 className="text-2xl font-bold text-slate-800">Scan Document</h2>
            <p className="text-slate-500 max-w-xs mx-auto">
              Capture a photo or upload a PDF to extract text and analyze content.
            </p>
          </div>

          <div className="w-full max-w-sm space-y-4">
            <button
              onClick={triggerCamera}
              className="w-full bg-blue-600 hover:bg-blue-700 active:scale-95 transition-all text-white font-semibold py-4 px-6 rounded-2xl flex items-center justify-center gap-3 shadow-lg shadow-blue-200"
            >
              <Camera size={24} />
              <span>Use Camera</span>
            </button>

            <button
              onClick={triggerUpload}
              className="w-full bg-white hover:bg-slate-50 active:scale-95 transition-all text-slate-700 font-semibold py-4 px-6 rounded-2xl flex items-center justify-center gap-3 shadow-md border border-slate-100"
            >
              <Upload size={24} />
              <span>Upload File</span>
            </button>
          </div>

          <input
            type="file"
            ref={fileInputRef}
            onChange={handleFileChange}
            accept="image/*,application/pdf"
            className="hidden"
          />
        </div>
      );
    };

    const ProcessingView = ({ state }) => {
      return (
        <div className="flex flex-col items-center justify-center h-full p-8 text-center space-y-8 animate-pulse-slow">
          <div className="relative">
            <div className="absolute inset-0 bg-blue-400 opacity-20 blur-2xl rounded-full animate-pulse"></div>
            <div className="relative bg-white w-24 h-24 rounded-3xl shadow-xl flex items-center justify-center">
              {state.status === 'thinking' ? (
                <BrainCircuit className="text-purple-600 animate-pulse" size={48} />
              ) : (
                <Sparkles className="text-blue-600 animate-spin-slow" size={48} />
              )}
            </div>
          </div>

          <div className="space-y-3">
            <h3 className="text-xl font-semibold text-slate-800">
              {state.status === 'thinking' ? 'Deep Analysis...' : 'Processing Document...'}
            </h3>
            <p className="text-slate-500 text-sm max-w-xs mx-auto">
              {state.message}
            </p>
          </div>

          {state.status === 'thinking' && (
            <div className="px-4 py-2 bg-purple-50 text-purple-700 text-xs font-medium rounded-full border border-purple-100 flex items-center gap-2">
              <Loader2 size={12} className="animate-spin" />
              Thinking Budget Active
            </div>
          )}

          {state.status === 'error' && (
            <button
              onClick={() => window.location.reload()}
              className="mt-4 px-6 py-2 bg-slate-200 text-slate-700 rounded-lg hover:bg-slate-300 transition-colors font-medium"
            >
              Go Back
            </button>
          )}
        </div>
      );
    };

    const ResultView = ({ doc, onBack, onAnalyze, isAnalyzing }) => {
      const [activeTab, setActiveTab] = useState('text');
      const [copied, setCopied] = useState(false);

      const handleCopy = () => {
        const textToCopy = activeTab === 'text' ? doc.textData : (doc.analysis || '');
        navigator.clipboard.writeText(textToCopy);
        setCopied(true);
        setTimeout(() => setCopied(false), 2000);
      };

      const handleDownload = () => {
        const element = document.createElement("a");
        const file = new Blob([doc.textData], { type: 'text/plain' });
        element.href = URL.createObjectURL(file);
        element.download = `documind-${doc.title}.txt`;
        document.body.appendChild(element);
        element.click();
        document.body.removeChild(element);
      };

      const handleSaveToDrive = async () => {
        const fileName = `documind-${doc.id}.txt`;
        const file = new File([doc.textData], fileName, { type: 'text/plain' });

        // @ts-ignore 
        if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
          try {
            await navigator.share({
              files: [file],
              title: doc.title,
              text: 'Scanned document from DocuMind',
            });
            return;
          } catch (err) {
            console.log('Share dismissed', err);
          }
        } else {
          handleDownload();
        }
      };

      const handleShare = async () => {
        if (navigator.share) {
          try {
            await navigator.share({
              title: doc.title,
              text: activeTab === 'text' ? doc.textData : doc.analysis,
            });
          } catch (err) {
            console.log('Share canceled');
          }
        } else {
          handleCopy();
        }
      };

      return (
        <div className="flex flex-col h-full bg-slate-50">
          {/* Header */}
          <div className="bg-white/80 backdrop-blur-md sticky top-0 z-10 px-4 py-3 border-b border-slate-200 flex items-center justify-between">
            <button onClick={onBack} className="p-2 -ml-2 text-slate-600 hover:text-slate-900">
              <ArrowLeft size={24} />
            </button>
            <h1 className="font-semibold text-slate-800 truncate max-w-[200px]">{doc.title}</h1>
            <button onClick={handleShare} className="p-2 -mr-2 text-blue-600 font-medium">
              Share
            </button>
          </div>

          {/* Tabs */}
          <div className="p-4 pb-0">
            <div className="flex bg-slate-200/50 p-1 rounded-xl">
              <button
                onClick={() => setActiveTab('text')}
                className={`flex-1 flex items-center justify-center gap-2 py-2 text-sm font-medium rounded-lg transition-all ${activeTab === 'text' ? 'bg-white text-slate-900 shadow-sm' : 'text-slate-500 hover:text-slate-700'
                  }`}
              >
                <FileText size={16} />
                Original Text
              </button>
              <button
                onClick={() => {
                  setActiveTab('analysis');
                  if (!doc.analysis) onAnalyze();
                }}
                className={`flex-1 flex items-center justify-center gap-2 py-2 text-sm font-medium rounded-lg transition-all ${activeTab === 'analysis' ? 'bg-white text-purple-700 shadow-sm' : 'text-slate-500 hover:text-slate-700'
                  }`}
              >
                {isAnalyzing ? <Sparkles size={16} className="animate-spin" /> : <Sparkles size={16} />}
                AI Analysis
              </button>
            </div>
          </div>

          {/* Content */}
          <div className="flex-1 overflow-y-auto p-4">
            <div className="bg-white rounded-2xl shadow-sm p-5 min-h-[300px] text-slate-700 whitespace-pre-wrap leading-relaxed border border-slate-100 select-text">
              {activeTab === 'text' ? (
                doc.textData
              ) : (
                isAnalyzing ? (
                  <div className="flex flex-col items-center justify-center h-48 text-purple-600 space-y-3">
                    <Sparkles className="animate-spin" size={32} />
                    <p className="text-sm font-medium">Analyzing with Gemini Pro...</p>
                    <p className="text-xs text-purple-400">Thinking budget: 32k tokens</p>
                  </div>
                ) : (
                  doc.analysis || (
                    <div className="text-center text-slate-400 py-10">
                      <p>Tap "AI Analysis" to summarize and extract insights.</p>
                    </div>
                  )
                )
              )}
            </div>
          </div>

          {/* Actions Toolbar */}
          <div className="bg-white border-t border-slate-200 px-4 py-4 safe-area-bottom">
            <div className="grid grid-cols-2 gap-3">
              <button
                onClick={handleCopy}
                className="flex items-center justify-center gap-2 bg-slate-100 hover:bg-slate-200 active:bg-slate-300 text-slate-700 font-semibold py-3 rounded-xl transition-colors"
              >
                {copied ? <span className="text-green-600">Copied!</span> : <><Copy size={18} /> Copy Text</>}
              </button>
              <button
                onClick={handleSaveToDrive}
                className="flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white font-semibold py-3 rounded-xl transition-colors shadow-blue-200 shadow-lg"
              >
                <Cloud size={18} />
                Save to Drive
              </button>
            </div>
            <p className="text-center text-xs text-slate-400 mt-3">
              Opens share sheet. Select "Drive" or "Save to Files".
            </p>
          </div>
        </div>
      );
    };

    const SettingsView = ({ onBack }) => {
      const [key, setKey] = useState(localStorage.getItem('documind_api_key') || '');
      const [saved, setSaved] = useState(false);

      const handleSave = () => {
        localStorage.setItem('documind_api_key', key);
        // Reset AI instance to force recreation with new key
        aiInstance = null;
        setSaved(true);
        setTimeout(() => setSaved(false), 2000);
      };

      return (
        <div className="flex flex-col h-full bg-slate-50">
          <header className="px-4 py-3 bg-white border-b border-slate-100 flex items-center">
            <button onClick={onBack} className="p-2 -ml-2 text-slate-600 hover:text-slate-900">
              <ArrowLeft size={24} />
            </button>
            <span className="font-semibold ml-2">Settings</span>
          </header>

          <div className="p-6 space-y-6">
            <div className="space-y-2">
              <h3 className="text-lg font-semibold text-slate-800">Gemini API Key</h3>
              <p className="text-sm text-slate-500">
                Enter your Google Gemini API key to enable document processing.
                You can get one from <a href="https://aistudio.google.com/app/apikey" target="_blank" className="text-blue-600 underline">Google AI Studio</a>.
              </p>
              <input
                type="password"
                value={key}
                onChange={(e) => setKey(e.target.value)}
                placeholder="AIzaSy..."
                className="w-full p-4 rounded-xl border border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all"
              />
            </div>

            <button
              onClick={handleSave}
              className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-blue-200 transition-all active:scale-95"
            >
              {saved ? 'Saved!' : 'Save API Key'}
            </button>

            <div className="pt-6 border-t border-slate-200">
              <p className="text-xs text-center text-slate-400">
                Version 1.0.1 â€¢ DocuMind
              </p>
            </div>
          </div>
        </div>
      );
    };

    // --- MAIN APP ---

    const App = () => {
      const [view, setView] = useState('HOME');
      const [processing, setProcessing] = useState({ status: 'idle' });
      const [documents, setDocuments] = useState([]);
      const [currentDoc, setCurrentDoc] = useState(null);
      const [rawFile, setRawFile] = useState(null);
      const [isAnalyzing, setIsAnalyzing] = useState(false);

      useEffect(() => {
        const saved = localStorage.getItem('documind_scans');
        if (saved) {
          try {
            setDocuments(JSON.parse(saved));
          } catch (e) {
            console.error("Failed to load history", e);
          }
        }
      }, []);

      useEffect(() => {
        localStorage.setItem('documind_scans', JSON.stringify(documents));
      }, [documents]);

      const handleFileSelected = async (file) => {
        setView('PROCESSING');
        setProcessing({ status: 'uploading', message: 'Reading file...' });

        // Check for API Key first
        const apiKey = localStorage.getItem('documind_api_key');
        if (!apiKey && !((typeof process !== 'undefined' && process.env && process.env.API_KEY))) {
          alert("Please set your Gemini API Key in Settings first.");
          setView('HOME');
          return;
        }

        try {
          const base64Data = await fileToBase64(file);
          setRawFile({ data: base64Data, mimeType: file.type });

          setProcessing({ status: 'ocr', message: 'Extracting text with Gemini Vision...' });

          const text = await extractTextFromDocument(base64Data, file.type);

          const newDoc = {
            id: Date.now().toString(),
            timestamp: Date.now(),
            title: `Scan ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`,
            textData: text,
            type: file.type.includes('pdf') ? 'pdf' : 'image',
          };

          setCurrentDoc(newDoc);
          setDocuments(prev => [newDoc, ...prev]);
          setProcessing({ status: 'complete' });
          setView('RESULT');

        } catch (error) {
          console.error("Processing Error:", error);
          let errorMsg = error.message || "Unknown error";
          if (errorMsg.includes("404")) errorMsg = "Model not found. Check model name.";
          if (errorMsg.includes("403") || errorMsg.includes("API key")) errorMsg = "Invalid API Key. Check Settings.";
          if (errorMsg.includes("429")) errorMsg = "Quota exceeded. Try again later.";

          setProcessing({ status: 'error', message: `Error: ${errorMsg}` });
          // Don't auto-dismiss error so user can read it
          // setTimeout(() => setView('HOME'), 3000);
        }
      };

      const performAnalysis = async () => {
        if (!currentDoc) return;

        try {
          const analysis = await analyzeDocumentContent(
            currentDoc.textData,
            rawFile?.data,
            rawFile?.mimeType
          );

          const updatedDoc = { ...currentDoc, analysis };
          setCurrentDoc(updatedDoc);
          setDocuments(prev => prev.map(d => d.id === updatedDoc.id ? updatedDoc : d));
        } catch (error) {
          console.error(error);
          alert("Analysis failed. Please check your API key quota.");
        }
      };

      const onAnalyzeRequest = async () => {
        setIsAnalyzing(true);
        await performAnalysis();
        setIsAnalyzing(false);
      };

      const renderHome = () => (
        <div className="flex flex-col h-full bg-slate-50">
          <header className="px-6 pt-12 pb-6 bg-white border-b border-slate-200 flex items-center justify-between">
            <div>
              <div className="flex items-center gap-3 mb-2">
                <div className="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center text-white shadow-lg shadow-blue-200">
                  <FileText size={20} />
                </div>
                <h1 className="text-2xl font-bold text-slate-800 tracking-tight">DocuMind</h1>
              </div>
              <p className="text-slate-500 text-sm font-medium">AI-Powered Document Scanner v1.0.2</p>
            </div>
            <button
              onClick={() => setView('SETTINGS')}
              className="p-2 text-slate-400 hover:text-slate-600 bg-slate-50 rounded-full hover:bg-slate-100 transition-colors"
            >
              <Settings size={24} />
            </button>
          </header>

          <div className="flex-1 overflow-y-auto p-4 space-y-4">
            <div className="flex items-center justify-between px-2">
              <h2 className="text-lg font-semibold text-slate-800 flex items-center gap-2">
                <Clock size={18} className="text-slate-400" />
                Recent Scans
              </h2>
            </div>

            {documents.length === 0 ? (
              <div className="flex flex-col items-center justify-center py-12 text-center space-y-4 opacity-60">
                <div className="w-16 h-16 bg-slate-200 rounded-full flex items-center justify-center">
                  <FileText size={32} className="text-slate-400" />
                </div>
                <p className="text-slate-500">No documents scanned yet.</p>
              </div>
            ) : (
              <div className="space-y-3">
                {documents.map(doc => (
                  <button
                    key={doc.id}
                    onClick={() => {
                      setCurrentDoc(doc);
                      setRawFile(null);
                      setView('RESULT');
                    }}
                    className="w-full bg-white p-4 rounded-2xl shadow-sm border border-slate-100 flex items-center gap-4 hover:bg-slate-50 transition-colors text-left group"
                  >
                    <div className={`w-12 h-12 rounded-xl flex items-center justify-center shrink-0 ${doc.type === 'pdf' ? 'bg-red-50 text-red-500' : 'bg-blue-50 text-blue-500'}`}>
                      <FileText size={24} />
                    </div>
                    <div className="flex-1 min-w-0">
                      <h3 className="font-semibold text-slate-800 truncate">{doc.title}</h3>
                      <p className="text-xs text-slate-500 truncate mt-1">
                        {doc.textData.substring(0, 40)}...
                      </p>
                    </div>
                    <ChevronRight className="text-slate-300 group-hover:text-slate-400" size={20} />
                  </button>
                ))}
              </div>
            )}
          </div>

          <div className="p-4 pb-8 bg-white border-t border-slate-200">
            <button
              onClick={() => setView('SCANNING')}
              className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-2xl shadow-xl shadow-blue-200 flex items-center justify-center gap-2 transition-transform active:scale-95"
            >
              <Plus size={24} strokeWidth={3} />
              <span>Scan New Document</span>
            </button>
          </div>
        </div>
      );

      return (
        <div className="max-w-md mx-auto h-screen bg-white shadow-2xl overflow-hidden relative">
          {view === 'HOME' && renderHome()}

          {view === 'SCANNING' && (
            <div className="h-full flex flex-col">
              <header className="px-4 py-3 bg-white border-b border-slate-100 flex items-center">
                <button onClick={() => setView('HOME')} className="p-2 -ml-2 text-slate-600 hover:text-slate-900">
                  <ArrowLeft size={24} />
                </button>
                <span className="font-semibold ml-2">New Scan</span>
              </header>
              <div className="flex-1">
                <Scanner onFileSelected={handleFileSelected} />
              </div>
            </div>
          )}

          {view === 'PROCESSING' && <ProcessingView state={processing} />}

          {view === 'RESULT' && currentDoc && (
            <ResultView
              doc={currentDoc}
              onBack={() => setView('HOME')}
              onAnalyze={onAnalyzeRequest}
              isAnalyzing={isAnalyzing}
            />
          )}

          {view === 'SETTINGS' && (
            <SettingsView onBack={() => setView('HOME')} />
          )}
        </div>
      );
    };

    const rootElement = document.getElementById('root');
    if (rootElement) {
      const root = ReactDOM.createRoot(rootElement);
      root.render(
        <React.StrictMode>
          <App />
        </React.StrictMode>
      );
    }
  </script>
</body>

</html>